{% extends "base.html" %}
{% load portal %}
{% load thumbnail %}
{% block head-link %}
   {{ block.super }}
   {% portal_css %}
{% endblock %}
{% block content %}
<section class="col-md-8">

    <ol class="breadcrumb">

        <li><a href="/">Página Inicial</a></li>

        {% if obj.tipo_publicacao %}
           <li><a href="{{ obj.tipo_publicacao.get_absolute_url }}">{{ obj.tipo_publicacao }}</a></li>
        {% else %}
           <li><a href="/portal/galeria/">Galeria</a></li>
        {% endif %}

        <li class="active">{{ obj }}</li>

    </ol>

    <article class="detalhes-publicacao">

	    <p class="data">{{ obj.data_criacao }}</p>

	    <h1 class="titulo" {% if obj.tipo_publicacao %} style="color: {{ obj.tipo_publicacao.cor }}"{% endif %} >{{ obj.nome }}</h1>

	    <hr />

	    <p class="autor">por {{ obj.autor }}</p>


            {% if tabela = 'publicacao' %}
	        <div class="texto">
     	            {% if obj.get_image %}
     	               <img src="{{ obj.get_url_image }}">
     	            {% endif %}
	            {{ obj.texto|safe }}
	        </div>
             {% elif tabela = 'galeria' %}

                <div class="row">
                {% for image in obj.get_all_images %}
                    <div class="col-lg-4 col-md-4 col-xs-6">
                       <a href="#myModal" data-toggle="modal" data-img-url="{{ image.get_url_image }}" class="img-galeria thumbnail">
                          <img src="{{ image.get_url_image }}"> 
                       </a>
                    </div>
                {% endfor %}
                <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header">
                          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                          <h4 class="modal-title" id="myModalLabel">{{ obj.nome }}</h4>
                        </div>
                        <div class="modal-body">
                          <img src="#">
                        </div>
                      </div>
                    </div>
                  </div>
                <script>
                    $('a.img-galeria').click(function () {
                         $('#myModal img').attr('src', $(this).attr('data-img-url'));
                     });
                </script>
                </div>

             {% endif %}

             {% include "agregacao.html" %}

	    <p class="social-share">
                <label>Compartilhe:</label>                
                    <a href="https://twitter.com/share" class="twitter-share-button" data-url="{{ request.build_absolute_uri }}" data-text="{{ obj.nome }}" data-via="escoladombosco">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
            </p>
	    <p class="tags">
 
                {% if obj.tipo_publicacao %}
	            <a class="btn btn-info btn-sm" href='{{ obj.tipo_publicacao.get_absolute_url }}'>
	                <span class="glyphicon glyphicon-tags"></span> &nbsp;
	         	    {{ obj.tipo_publicacao }}
	            </a>
                {% endif %}

	        {% for tag in obj|get_tags %}
	            <a class="btn btn-info btn-sm" href='{{ tag.get_absolute_url }}'>
	                <span class="glyphicon glyphicon-tags"></span> &nbsp;
	            	{{ tag }}
	            </a>
	        {% endfor %}

	    </p>

    </article>

    <article class="relacionados">

        {% if obj|get_related_objects %}
        <h3>veja também...</h3>
        <div class="row">
            {% for relacionado in obj|get_related_objects %}
                <div class="col-md-3 relacionado-item">
                    <a href="{{ relacionado.get_absolute_url }}" {% if relacionado.tipo_publicacao %}style="color:{{ relacionado.tipo_publicacao.cor }} !important"{% endif %}>
                        {% if relacionado.get_image %}
                            <img src="{% thumbnail relacionado.get_image 120x70 crop %}" style="width:100%" class="thumbnail hidden-xs">
                        {% endif  %}
                        <p>{{ relacionado.nome }} <span class="data">há {{ relacionado.data_criacao|timesince }}</span></p>
                    </a>
                </div>
            {% endfor %}
        </div>
        {% endif %}

    </article>

</section>

<aside class="col-md-4">
     {% include "social.html" %}
</aside>
{% endblock %}
